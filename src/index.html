<!--
    Aug 2019
    @nimadez
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="description" content="Voxel-based 3D modeling application for desktop and mobile browsers">
    <meta name="keywords" content="voxels, model, render, export, bake, electron, terrain, painting, symmetry, babylon-js, three-js, gltf, magicavoxel, voxel-generator, voxelizer, voxelization, three-mesh-bvh, three-gpu-pathtracer">
    <meta name="author" content="@nimadez">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@nimadez">
    <meta name="twitter:creator" content="@nimadez">
    <meta name="twitter:title" content="Voxel Builder">
    <meta name="twitter:description" content="Voxel-based 3D modeling application for desktop and mobile browsers">
    <meta name="theme-color" content="#1D2028">
    <title>Voxel Builder</title>
    <link rel="icon" href="./assets/appicon.png">
    <link rel="manifest" href="manifest.webmanifest">
    <style>
        @font-face {
            font-family: 'Roboto'; src: url(./assets/font_roboto_medium.ttf) format('truetype');
        }
        @font-face {
            font-family: 'Material Icons'; font-style: normal; font-weight: 400;
            src: url(./assets/font_materialicons.woff2) format('woff2');
        }
        :root { /* orange, steelblue, indianred */
            --font: Roboto;
            --font-size: 12px;
            --col-white: #b0b7c2;
            --intro: #00000040;
            --scene: #3D4250;
            --border-radius: 4px;
            --border: solid 1px #00000025;
            --menu-bg: #2e3542DC;
            --menu-shadow: #00000040;
            --menu-btn-height: 30px;
            --btn-height: 32px;
            --btn-bg: #2b313dDC;
            --btn-bg-shadow: inset 5px 5px 15px #00000050, inset -5px -5px 5px #00000010;
            --btn-color: #969fb1;
            --btn-tool-border: solid 1px #4682b4AA;
            --btn-confirm-border: solid 1px #cd5c5cAA;
            --input-bg: #21252eDC;
            --input-color: #8d98aa;
            --input-height: 26px;
            --label: #7f8da1;
            --label-info: #94a0b1EE;
            --label-help: #657183;
            --cat-bg: #292e38AA;
            --cat-color: #69768d;
            --cat-border: solid 1px #3e485caa;
            --text-shadow: 1px 1px 0 #000;
            --tool-color-hover: #333333;
            --colorpicker-bg: #282d38ee;
            --notifier-bg: #7f8da1EE;
            --notifier-color: #222222;
            --confirm: #4682b4CC;
        }
        * { margin: 0; padding: 0; outline: none; }
        html, body { overscroll-behavior-y: contain; user-select: none; overflow: hidden; touch-action: pan-x; -webkit-tap-highlight-color: transparent; } /* prevent pull-down refresh and text selection on chrome mobile + prevent forced scroll + blue tap highlight on touch */
        body { text-rendering: optimizeSpeed; background: var(--scene); font-family: var(--font); font-size: var(--font-size); color: silver; position: fixed; width: 100%; height: 100%; cursor: default; }
        a { font-family: var(--font); font-size: var(--font-size); color: steelblue; text-decoration: none; }
        input[type=number] { font-family: var(--font); font-size: 13px; width: 98%; height: var(--input-height); text-indent: 5px; background: var(--input-bg); color: var(--input-color); border: var(--border); border-radius: 0; text-align: left; }
        input[type=number]:disabled { opacity: 0.5; }
        input[type=number] { appearance: textfield; }
        input[type=range] { accent-color: steelblue; width: 100%; }
        input[type=range]::-webkit-slider-runnable-track { background-color: slategray; height: 2px; -webkit-appearance: none; }
        input[type=range]::-webkit-slider-thumb { transform: scale(0.85); cursor: pointer; margin-top: -7px; }
        input[type=text] { font-family: var(--font); font-size: 13px; letter-spacing: 0.04em; width: 98%; height: var(--input-height); background: var(--input-bg); color: var(--input-color); text-indent: 5px; border: var(--border); border-radius: 0; text-align: left; }
        input[type=url] { font-family: var(--font); font-size: 13px; width: 98%; height: var(--input-height); background: var(--input-bg); color: var(--input-color); margin-left: -2px; text-indent: 5px; border: var(--border); border-radius: 0; text-align: left; }
        input[type=checkbox] { filter: brightness(0.7); transform: scale(0.8); margin: 3px 0 3px 0; vertical-align: -2px; cursor: pointer; }
        input[type=checkbox] + label { cursor: pointer; }
        input[type=checkbox]:checked { accent-color: steelblue; filter: none; }
        input[type=checkbox]:disabled { opacity: 0.5; }
        input[type=color] { width: 100%; height: 20px; border-radius: var(--border-radius); background: none; border: none; outline: none; }
        input[type=color]::-webkit-color-swatch-wrapper { padding: 0; border: none; }
        input[type=color]::-webkit-color-swatch { border-radius: var(--border-radius); border: none; }
        button { height: var(--btn-height); font-family: var(--font); font-size: var(--font-size); background: var(--btn-bg); color: var(--btn-color); letter-spacing: 0.04em; border-radius: var(--border-radius); border: var(--border); }
        button:disabled { background: var(--btn-bg); opacity: 0.5; pointer-events: none; }
        label { font-family: var(--font); font-size: var(--font-size); color: var(--label); letter-spacing: 0.04em; margin: 0; }
        label.help { display: block; margin-top: 8px; font-size: 10px; color: var(--label-help); cursor: default; }
        select { font-family: var(--font); font-size: var(--font-size); width: 100%; background: var(--menu-bg); color: var(--btn-color); padding: 5px 0 5px 0; border: var(--border); border-radius: var(--border-radius); outline: none; text-align: center; vertical-align: middle; }
        option { font-family: var(--font); font-size: var(--font-size); color: silver; background: var(--btn-bg); }
        ul { list-style-type: none; }
        ul li { font-family: var(--font); font-size: var(--font-size); color: var(--btn-color); border-radius: var(--border-radius); text-align: center; }
        #canvas { z-index: 0; pointer-events: none; background: var(--scene); position: absolute; width: 100%; height: 100%; }
        #canvas_three { z-index: 300; display: none; width: 100%; height: 100%; position: absolute;
            background-color: #363d46;
            background-image: linear-gradient(45deg, #30373d 25%, transparent 20%), linear-gradient(-45deg, #30373d 25%, transparent 25%),
                              linear-gradient(45deg, transparent 75%, #30373d 75%), linear-gradient(-45deg, transparent 75%, #30373d 75%);
            background-size: 39px 39px; background-position: 0 0, 0 19px, 19px -19px, -19px 0; }
        #canvas_palette { z-index: 1; image-rendering: pixelated; position: relative; width: 100%; height: 32000px; }
        #menus { display: none; }
        .menu { z-index: 1000; display: none; background: var(--menu-bg); border: var(--border); box-shadow: 0 1px 3px var(--menu-shadow); position: absolute; top: 0; left: 80px; width: 125px; height: fit-content; padding: 0 4px 4px 4px; border-bottom-left-radius: var(--border-radius); border-bottom-right-radius: var(--border-radius); }
        .menu li { background: none; text-align: left; border: none; padding: 0; cursor: default; }
        .menu li div .material-icons { font-size: 16px; color: var(--cat-color); margin-top: 3px; }
        .menu button { width: 100%; height: var(--menu-btn-height); }
        .menu .category { color: var(--cat-color); background: linear-gradient(180deg, #00000035 0%, var(--cat-bg) 100%); border: var(--cat-border); font-size: 11px; letter-spacing: 0.08em; text-align: center; margin: 3px 0 3px 0; padding: 3px 0 2px 0; border-radius: var(--border-radius); pointer-events: none; }
        #toolbar { z-index: 1000; width: 75px; display: flex; flex-direction: column; position: absolute; left: 0; top: 0; }
        #toolbar li { background: none; border-radius: 0; border: none; padding: 0; }
        #toolbar li:nth-child(1) { height: var(--btn-height); box-shadow: none; display: flex; flex-direction: row; align-self: center; }
        #toolbar li:nth-child(1) :first-child { width: 37px; float: left; }
        #toolbar li:nth-child(1) :first-child :first-child { width: 100%; }
        #toolbar li:nth-child(1) :last-child { width: 38px; border-left: none; }
        #toolbar li:nth-child(1) :last-child :first-child { width: 100%; }
        #toolbar button { width: 100%; border: var(--border); border-top: none; border-radius: 0; }
        #toolbar button.panel_select { color: steelblue; text-decoration: underline; }
        #toolbar .sep { margin-top: 5px; border-top: var(--border); }
        #toolbar .corner_top { border-top-right-radius: var(--border-radius); }
        #toolbar .corner_bot { border-bottom-right-radius: var(--border-radius); }
        #toolbar-screen-top-mode { z-index: 500; display: none; margin: 5px 0 5px 0; width: 210px; left: 50%; margin-left: -105px; top: 0; position: fixed; text-align: center; }
        #toolbar-screen-top-mode li { width: 100%; padding: 8px 0 8px 0; background: var(--btn-bg); color: var(--btn-color); border: none; font-size: 11px; letter-spacing: 0.05em; cursor: pointer; }
        #toolbar-screen-top-mode li:nth-child(1) { border-right: none; border-radius: 0; border-bottom-left-radius: var(--border-radius); border-top-left-radius: var(--border-radius); }
        #toolbar-screen-top-mode li:nth-child(2) { border-left: var(--border); border-right: var(--border); border-radius: 0; }
        #toolbar-screen-top-mode li:nth-child(3) { border-left: none; border-radius: 0; border-bottom-right-radius: var(--border-radius); border-top-right-radius: var(--border-radius); }
        #toolbar-screen-top-mode li.mode_select { color: orange; }
        #toolbar-screen-top-mem { z-index: 500; width: 210px; left: 50%; margin-left: -105px; top: 40px; position: fixed; text-align: center; }
        #toolbar-screen-top-mem li { width: 40px; text-indent: 2px; font-size: 11px; padding: 5px; background: none; text-shadow: var(--text-shadow); cursor: pointer; }
        #toolbar-screen-top-mem li:first-child { float: left; }
        #toolbar-screen-top-mem li:last-child { float: right; }
        #toolbar-screen-storage { z-index: 500; display: none; flex-direction: column; gap: 4px; top: 5px; right: 5px; position: fixed; }
        #toolbar-screen-storage button { border: none; width: 50px; font-size: 11px; }
        #toolbar-screen-material { z-index: 500; display: none; flex-direction: column; gap: 4px; position: fixed; right: 5px; bottom: 135px; }
        #toolbar-screen-material button { border: none; width: 50px; }
        #toolbar-screen-material button.tool { border-left: var(--btn-tool-border); }
        #toolbar-screen-material input[type=color] { z-index: 500; width: 50px; height: var(--btn-height); }
        #toolbar-screen-render { z-index: 301; display: none; flex-direction: column; gap: 4px; right: 5px; top: 5px; position: fixed; }
        #toolbar-screen-render button { border: none; width: 50px; font-size: 11px; }
        #toolbar-screen-render button .material-icons { font-size: 24px; }
        #toolbar-screen-export { z-index: 500; display: none; flex-direction: column; gap: 4px; position: fixed; right: 5px; top: 5px; }
        #toolbar-screen-export button { border: none; width: 50px; font-size: 11px; }
        #toolbar-screen-toggles { z-index: 9; display: none; gap: 5px; left: 50%; bottom: 25px; transform: translateX(-50%); position: absolute; text-align: center; }
        #toolbar-screen-toggles button { z-index: 9; width: 100%; min-width: 30px; opacity: 0.75; color: aqua; border: var(--border); background: none; font-size: 18px; font-weight: bold; text-shadow: var(--text-shadow); border-radius: var(--border-radius); text-align: center; }
        #toolbar-screen-toggles li, #toolbar-screen-toggles li:hover { background: none; }
        #toolbar-screen-toggles .material-icons { font-size: 19px; margin-top: -4px; }
        #hover { z-index: 900; display: none; bottom: 130px; left: 50%; margin-left: -17px; position: absolute; }
        #hover .tool_camera { z-index: 2220; position: relative; padding: 5px; top: 30px; left: 0; border-radius: var(--border-radius); cursor: move; }
        #hover button { height: 30px; border: none; }
        #hover li { z-index: 2210; background: var(--btn-bg); padding: 5px; transition: all 0.2s ease-in-out; border-radius: var(--border-radius); position: absolute; cursor: pointer; }
        #hover li.tool_selector { background: orange; }
        #hover li.hover_item_hide { opacity: 0; pointer-events: none; }
        #hover .material-icons { font-size: 20px; }
        #palette { z-index: 400; display: none; background: #00000008; position: absolute; right: 5px; top: 80px; bottom: 285px; padding-right: 1px; overflow-y: scroll; overflow-x: hidden; }
        #meshlist { z-index: 400; display: none; background: #00000008; width: 50px; position: absolute; right: 5px; top: 80px; bottom: 5px; overflow-y: scroll; overflow-x: hidden; }
        #meshlist .item_name { background: #3D4250DD; width: 42px; height: 22px; padding-top: 8px; margin-bottom: 1px; font-size: 11px; border: var(--border); border-left-width: 2px; border-radius: var(--border-radius); text-align: center; }
        #meshlist .item_name.mesh_select { background: var(--btn-bg); color: steelblue; border-right-color: orange; }
        #snapshots { height: auto; max-height: 630px; }
        #snapshots li { display: flex; flex-direction: row; gap: 2px; margin-bottom: 3px; }
        #snapshots li:last-child { margin-bottom: 0; }
        #snapshots li img { object-fit: contain; width: 100%; height: 58px; background: #292f3aaa; box-shadow: inset 0 0 10px #25262e80; border-radius: var(--border-radius); overflow: hidden; cursor: pointer; }
        #snapshots li div { display: flex; flex-direction: column; gap: 2px; width: 80px; height: 100%; }
        #snapshots li div button { font-size: 11px; letter-spacing: 0.05em; width: 100%; }
        #snapshots li div :first-child { height: auto; padding: 4px 0 4px 0; }
        #snapshots li div :last-child { height: auto; padding: 9px 0 9px 0; }
        #btn-symm-axis-s, #btn-symm-axis-x, #btn-symm-axis-y, #btn-symm-axis-z { font-size: 13px; font-weight: bold; }
        #color-wheel { z-index: 301; display: none; right: 10px; bottom: 8px; position: fixed; }
        #color-picker { z-index: 2500; display: none; padding: 5px; background: var(--colorpicker-bg); width: 130px; height: fit-content; border: solid 1px #171b22; border-radius: var(--border-radius); position: fixed; }
        #color-picker li, #color-picker li:hover { background: none; box-shadow: none; }
        #color-picker label { width: 40px; }
        #color-picker-wheel { margin: 5px 0 6px 0; }
        #color-picker-selected { display: flex; flex-direction: row; margin-bottom: 5px; }
        #color-picker-selected div { width: 100%; height: 15px; background: black; }
        #color-picker-selected :first-child { border-top-left-radius: 10px; border-bottom-left-radius: 10px; cursor: pointer; }
        #color-picker-selected :last-child { border-top-right-radius: 10px; border-bottom-right-radius: 10px; }
        #options_screen { z-index: 501; display: none; background: #ffffff08; padding: 0 5px 0 5px; border-radius: var(--border-radius); flex-direction: row; gap: 10px; position: absolute; top: 73px; left: 50%; transform: translateX(-50%); }
        #options_screen label { text-shadow: var(--text-shadow); font-size: 10px; }
        #marquee { z-index: 500; display: none; background: #00ffff10; border: dotted 2px aqua; position: fixed; }
        #info { z-index: 2; display: none; color: var(--label-info); letter-spacing: 0.06em; text-shadow: var(--text-shadow); font-size: 10px; position: absolute; margin-bottom: 2px; width: 100%; bottom: 2px; text-align: center; pointer-events: none; }
        #info_tool { z-index: 501; display: none; color: var(--label-info); letter-spacing: 0.06em; text-shadow: var(--text-shadow); font-size: 10px; position: absolute; padding: 2px; width: auto; top: 47px; left: 50%; transform: translateX(-50%); text-align: center; text-transform: uppercase; }
        #info_render { z-index: 301; display: none; color: var(--label-info); letter-spacing: 0.06em; text-shadow: var(--text-shadow); font-size: 10px; position: absolute; padding: 2px; width: 100%; bottom: 2px; text-align: center; pointer-events: none; }
        #notifier { z-index: 2000; display: none; font-size: 11px; background: var(--notifier-bg); color: var(--notifier-color); border: solid 1px var(--border); position: absolute; width: fit-content; min-width: 100px; left: 50%; top: 100px; transform: translateX(-50%); padding: 3px 6px 2px 6px; letter-spacing: 0.08em; text-align: center; border-radius: var(--border-radius); pointer-events: none; }
        #progressbar { z-index: 2000; background: linear-gradient(135deg, orange 25%, #ffd17c 25%, #ffd17c 50%, orange 50%, orange 75%, #ffd17c 75%); background-size: 20px 20px; width: 0; max-width: 100%; height: 3px; bottom: 0; position: fixed; }
        #confirm { z-index: 2500; display: none; flex-direction: row; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); border-radius: var(--border-radius); }
        #confirm :first-child { background: var(--confirm); color: white; box-shadow: var(--btn-bg-shadow); width: 50%; height: 100%; position: relative; }
        #confirm :first-child::after { content: ">"; color: var(--col-white); font-size: 14px; font-weight: bold; }
        #confirm :first-child .material-icons { font-size: 10px; color: var(--btn-color); margin-top: 8px; background: none; box-shadow: none; }
        #confirmblocker { z-index: 2400; display: none; background: none; position: absolute; width: 100%; height: 100%; }
        #introscreen { z-index: 5000; background: var(--intro); backdrop-filter: blur(15px); position: absolute; width: 100%; height: 100%; }
        #introscreen .anim { position: absolute; left: 50%; top: 50%; margin-left: -15px; }
        #introscreen .logo { color: orange; font-family: var(--font); font-size: 24px; letter-spacing: 0.08em; width: 200px; height: 30px; position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: -100px; text-align: center; }
        #introscreen .logo :first-child { font-weight: normal; color: var(--col-white); }
        #introscreen .progress { color: slategray; font-size: 12px; letter-spacing: 0.2em; width: 200px; height: 20px; position: absolute; left: 50%; top: 50%; margin-left: -100px; margin-top: 90px; text-align: center; }
        #shortcuts { z-index: 3000; display: none; background: #222731EE; padding: 20px; width: calc(100vw - 40px); height: calc(100vh - 40px); position: fixed; overflow-y: scroll; }
        #shortcuts table { display: flex; flex-direction: column; }
        #shortcuts tr { font-size: 14px; }
        #shortcuts tr :first-child { text-align: center; }
        #shortcuts th, td { width: fit-content; padding: 2px; }
        #shortcuts span { font-size: 14px; color: slategray; }
        #shortcuts hr { margin: 10px 0 10px 0; border-top: solid 1px slategray; }
        #menu-about .about { font-size: 13px; line-height: 1.4em; letter-spacing: 0.08em; background: var(--input-bg); color: var(--col-white); border: solid 1px #00000040; padding: 5px; }
        #menu-about .about :first-child { text-align: center; }
        .tool { border-left: var(--btn-tool-border); }
        .tool_selector { background: orange; color: var(--tool-color-hover); box-shadow: var(--btn-bg-shadow); }
        .row { display: flex; width: 100%; align-items: center; }
        .row_input { display: flex; width: 100%; gap: 5px; align-items: center; }
        .row_input :first-child { width: 100%; }
        .row_color { margin-bottom: 4px; display: flex; width: 100%; gap: 5px; align-items: center; }
        .row_color :first-child { width: 100%; }
        .row_panel { display: flex; width: 100%; height: 25px; align-items: center; gap: 0; }
        .row_panel div { width: 100%; padding: 5px; text-align: center; }
        .row_round_s { border-top-right-radius: 0; border-bottom-right-radius: 0; }
        .row_round_m { border-radius: 0; }
        .row_round_e { border-top-left-radius: 0; border-bottom-left-radius: 0; }
        .spacer { height: 3px; }
        .Z { margin-right: 4px; }
        .material-icons { font-family: 'Material Icons'; font-weight: normal; font-style: normal; font-size: 18px; vertical-align: middle; text-align: center; line-height: 1; letter-spacing: normal; text-transform: none; display: inline-block; white-space: nowrap; word-wrap: normal; direction: ltr; pointer-events: none; font-feature-settings: 'liga'; -webkit-font-feature-settings: 'liga'; -webkit-font-smoothing: antialiased; }
        ::placeholder { color: #5e6e7e; }
        ::selection { background: steelblue; color: white; }
        ::-webkit-scrollbar { width: 3px; }
        ::-webkit-scrollbar-track { background: none; }
        ::-webkit-scrollbar-thumb { background: steelblue; border-radius: 2px; }

        @-moz-document url-prefix() {
            div, li, ul { font-family: var(--font); scrollbar-width: thin; }
            input[type=range] { background: none; }
            input[type=range]::-moz-range-track { background: slategray; height: 2px; }
            input[type=range]::-moz-range-thumb { background: steelblue; margin-top: 0; border: none; cursor: pointer; }
            input[type=color]::-moz-color-swatch { border: none; }
            select { text-indent: 2px; }
            .menu .category { padding-top: 2px; }
            #palette { bottom: 285px; scrollbar-color: steelblue transparent; }
            #meshlist { scrollbar-color: steelblue transparent; }
            #snapshots li div :last-child { padding: 8px 0 8px 0; }
            .Z { margin-right: 5px; }
        }

        /* hovers on desktop only */
        @media (pointer: fine) {
            a:hover { color: orange; text-decoration: none; }
            input[type=number]:hover { appearance: unset; }
            input[type=text]:hover { cursor: text; }
            input[type=url]:hover { cursor: text; }
            input[type=color]:hover { cursor: pointer; }
            button:hover { color: steelblue; cursor: pointer; }
            select:hover { color: steelblue; cursor: pointer; }
            ul li:hover { color: steelblue; box-shadow: var(--btn-bg-shadow); }
            ul li:hover.material-icons { color: steelblue; }
            .menu li:hover { background: none; box-shadow: none; }
            .menu li div:hover i.material-icons { color: steelblue; }
            #toolbar button:hover.panel_select { color: steelblue; }
            #toolbar-screen-top-mem li:hover { box-shadow: none; color: steelblue }
            #toolbar-screen-material button:hover.tool_selector { background: orange; color: var(--tool-color-hover); }
            #toolbar-screen-material li:first-child { box-shadow: none; }
            #meshlist .item_name:hover { background: var(--btn-bg); color: steelblue; border-right-color: orange; cursor: pointer; }
            #options_screen li:hover { box-shadow: none; }
            .tool_selector:hover { background: orange; color: var(--tool-color-hover); }
            .row_panel:hover { cursor: pointer; }
            ::-webkit-scrollbar-thumb:hover { background: steelblue; }
        }

        .cube { transform-style: preserve-3d; transform: rotateX(45deg) rotateZ(45deg); animation: rotation 3s infinite; }
        .cube-faces { transform-style: preserve-3d; height: 35px; width: 35px; position: relative; }
        .cube-face { position: absolute; inset: 0; border: solid 1px orange; box-shadow: inset 0 0 20px #FFA50030; outline: 1px solid transparent; }
        .cube-face.shadow { transform: translateZ(-15px) scale(1.2); background: #11111130; border-color: #11111140; box-shadow: none; }
        .cube-face.top { transform: translateZ(35px); }
        .cube-face.front { transform-origin: 0 50%; transform: rotateY(-90deg); }
        .cube-face.back { transform-origin: 0 50%; transform: rotateY(-90deg) translateZ(-35px); }
        .cube-face.right { transform-origin: 50% 0; transform: rotateX(-90deg) translateY(-35px); }
        .cube-face.left { transform-origin: 50% 0; transform: rotateX(-90deg) translateY(-35px) translateZ(35px); }
        @keyframes rotation {
            0% { transform: rotateX(45deg) rotateY(0) rotateZ(45deg); animation-timing-function: cubic-bezier(0.1, 0.2, 0.3, 1); }
            100% { transform: rotateX(45deg) rotateY(0) rotateZ(405deg); animation-timing-function: cubic-bezier(0.2, 0.3, 0.4, 1); }
        }

        .reinvented-color-wheel,
        .reinvented-color-wheel--hue-wheel,
        .reinvented-color-wheel--hue-handle,
        .reinvented-color-wheel--sv-space,
        .reinvented-color-wheel--sv-handle { touch-action: manipulation; touch-action: none; -webkit-touch-callout: none; -webkit-tap-highlight-color: transparent; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        .reinvented-color-wheel { position: relative; display: inline-block; line-height: 0; border-radius: 50%; }
        .reinvented-color-wheel--hue-wheel { border-radius: 50%; }
        .reinvented-color-wheel--sv-space { position: absolute; left: 0; top: 0; right: 0; bottom: 0; margin: auto; }
        .reinvented-color-wheel--hue-handle,
        .reinvented-color-wheel--sv-handle { position: absolute; box-sizing: border-box; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 0 1px black inset; }
        .reinvented-color-wheel--hue-handle { pointer-events: none; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <canvas id="canvas_three"></canvas>

    <div id="menus">

        <ul id="toolbar">
            <li>
                <button title="About" id="toolbar_btn_about"><i class="material-icons" style="color:steelblue">contact_support</i></button>
                <button title="Preferences" id="toolbar_btn_prefs"><i class="material-icons">settings</i></button>
            </li>
            <li title="File"><button id="toolbar_btn_file">FILE</button></li>
            <li title="Snapshots" class="corner_bot"><button id="toolbar_btn_storage" class="corner_bot">STORAGE</button></li>
            <li title="Camera" class="sep corner_top"><button id="toolbar_btn_camera" class="corner_top">CAMERA</button></li>
            <li title="Render" class="corner_bot"><button id="toolbar_btn_render" class="corner_bot">RENDER</button></li>
            <li title="Create" class="sep corner_top"><button id="toolbar_btn_create" class="corner_top">CREATE</button></li>
            <li title="Voxelize" class="corner_bot"><button id="toolbar_btn_voxelize" class="corner_bot">VOXELIZE</button></li>
            <li title="Symmetry" class="sep corner_top"><button id="toolbar_btn_symm" class="corner_top">SYMM.</button></li>
            <li title="Draw"><button id="toolbar_btn_draw">DRAW</button></li>
            <li title="Paint"><button id="toolbar_btn_paint">PAINT</button></li>
            <li title="XForm"><button id="toolbar_btn_xform">XFORM</button></li>
            <li title="Color Groups" class="corner_bot"><button id="toolbar_btn_groups" class="corner_bot">GROUPS</button></li>
            <li title="Bakery" class="sep corner_top"><button id="toolbar_btn_bakery" class="corner_top">BAKERY</button></li>
            <li title="PBR"><button id="toolbar_btn_pbr">PBR</button></li>
            <li title="Export" class="corner_bot"><button id="toolbar_btn_export" class="corner_bot">EXPORT</button></li>
        </ul>

        <ul class="menu panel" id="menu-about">
            <li class="category">ABOUT</li>
            <li class="about">
                <div><span style="color: orange">V</span>OXEL BUILDER</div>
                &#8627; 4.7.8 BETA
                <br>&#8627; <a href="https://github.com/nimadez/voxel-builder/" target="_blank">GitHub</a>
                <br>&#8627; <a href="https://github.com/nimadez/voxel-builder/releases" target="_blank">Changelog</a>
                <br>DEVELOPER
                <br>&#8627; <a href="https://nimadez.github.io/" target="_blank">@nimadez</a>
            </li>
            <li class="category">HELP</li>
            <li><button onclick="window.open('https://github.com/nimadez/voxel-builder/wiki', '_blank').focus()">Documentation</button></li>
            <li><button id="btn_action_about_shortcuts">Shortcuts</button></li>
            <li class="category">EXAMPLES</li>
            <li>
                <select id="btn_action_about_examples">
                    <option value="">Examples</option>
                    <option value="user/startup.json">User Startup</option>
                    <option value="examples/model_archinterior.json">Arch Interior</option>
                    <option value="examples/model_menger.json">Menger Sponge</option>
                    <option value="examples/test_pt_cornellbox.json">Test PT: Cornell Box</option>
                    <option value="examples/test_pt_indirect.json">Test PT: Indirect Bounce</option>
                    <option value="examples/test_rectadd.json">Test: Rect Add Tool</option>
                    <option value="examples/test_symmetry_odd.json">Test: Symmetry Odd</option>
                    <option value="examples/test_symmetry_even.json">Test: Symmetry Even</option>
                    <option value="examples/test_voxelizer_2d.json">Test: Voxelizer 2D</option>
                    <option value="examples/startup_v4.json">Startup v4</option>
                    <option value="examples/startup_legacy.json">Startup (legacy)</option>
                </select>
                <select id="btn_action_about_examples_vox">
                    <option value="">MagicaVoxel</option>
                    <option value="examples/mv_charactercat_ephtracy.json">Character Cat @ephtracy</option>
                    <option value="examples/mv_tankdestroyer_arsgametm.json">Tank Destroyer @arsgametm</option>
                    <option value="examples/mv_skyscraper_kluchek.json">Skyscraper @kluchek</option>
                    <option value="examples/mv_odyssey_kluchek.json">Odyssey @kluchek</option>
                </select>
            </li>
            <li class="category">EXTRAS</li>
            <li title="NOTICE: Extras will not be updated."><button onclick="window.open('https://nimadez.github.io/voxel-builder/extras/asset-viewer', '_blank').focus()">Asset Viewer</button></li>
            <li title="NOTICE: Extras will not be updated."><button onclick="window.open('https://nimadez.github.io/voxel-builder/extras/pixel-monk', '_blank').focus()">Pixel Monk</button></li>
            <li title="NOTICE: Extras will not be updated."><button onclick="window.open('https://nimadez.github.io/voxel-builder/extras/vi2xel', '_blank').focus()">VIÂ²XEL</button></li>
        </ul>

        <ul class="menu panel" id="menu-prefs">
            <li class="category">PREFERENCES</li>
            <li class="row">
                <button id="btn_action_fullscreen" class="row_round_s" title="Fullscreen"><i class="material-icons">fullscreen</i></button>
                <button id="btn_action_reloadapp" class="row_round_e" title="Reload App"><i class="material-icons">cached</i></button>
            </li>
            <li class="category">GENERAL</li>
            <li title="Less battery drain (&#60;100 ms startup)"><input type="checkbox" id="pref_minimal"> <label for="pref_minimal">Minimal UIX</label></li>
            <li><input type="checkbox" id="pref_user_startup"> <label for="pref_user_startup">User Startup</label></li>
            <li class="spacer"></li>
            <li class="row_input"><label>Start Box</label> <input type="number" id="pref_startbox_size" class="ignorekeys" value="20" min="1" max="40" step="1"></li>
            <li class="row_input"><label>Palette</label> <input type="number" id="pref_palette_size" class="ignorekeys" value="1" min="1" max="20" step="1"></li>
            <li class="row_input" title="Maximum 100 Storages"><label>Snapshot</label> <input type="number" id="pref_snapshot_num" class="ignorekeys" value="6" min="1" max="100" step="1"></li>
            <li class="category">INTERFACE</li>
            <li><input type="checkbox" id="pref_toolbar_icons"> <label for="pref_toolbar_icons">Icon Toolbar</label></li>
            <li><input type="checkbox" id="pref_help_labels"> <label for="pref_help_labels">Show Help Texts</label></li>
            <li title="Ignore and auto-accept swipe confirms"><input type="checkbox" id="pref_ignore_confirms"> <label for="pref_ignore_confirms">Ignore Confirms</label></li>
            <li title="Warning: Increased hardware utilization"><input type="checkbox" id="pref_glass_ui"> <label for="pref_glass_ui">Frosted Glass UI</label></li>
            <li class="spacer"></li>
            <li class="row_input"><label>UI Opacity</label> <input type="range" id="pref_ui_opacity" class="ignorekeys" value="0.8" min="0.6" max="0.9" step="0.05"></li>
            <li class="category">SCENE</li>
            <li class="row_color"><label for="pref_background_check">BG</label> <input type="color" id="pref_background_color" value="#151515"> <input type="checkbox" id="pref_background_check" style="width: 57px;"></li>
            <li class="row_color" title="General shade color is widely distributed throughout the app."><label>Shade</label><input type="color" id="pref_render_shade" value="#90A0B3"><button style="width: 52px; height: 20px;" title="Reset" onclick="this.previousElementSibling.value = '#90A0B3'; this.previousElementSibling.dispatchEvent(new Event('input', { bubbles: true }));">R</button></li>
            <li><input type="checkbox" id="pref_scene_pointcloud"> <label for="pref_scene_pointcloud">Point Cloud</label></li>
            <li class="category">RENDER</li>
            <li class="row">
                <label style="margin-right: 7px">Texture</label> <select id="pref_voxel_texture">
                    <option value="0">None</option>
                    <option value="1">Grid</option>
                    <option value="2">Checker</option>
                    <option value="3">Minecraft</option>
                </select>
            </li>
            <li class="row">
                <label style="margin-right: 10px">PostFX</label> <select id="pref_scene_postfx">
                    <option value="none">None</option>
                    <option value="fxOutline">Outline</option>
                    <option value="fxCustom">Custom</option>
                </select>
            </li>
            <li class="spacer"></li>
            <li class="row_input" title="PostFX Samples"><label>Samples</label> <input type="range" id="pref_scene_postfx_samples" class="ignorekeys" value="2" min="1" max="8" step="1"></li>
        </ul>

        <ul class="menu panel" id="menu-file">
            <li class="category">PROJECT</li>
            <li><input id="project_name" type="text" class="ignorekeys" value="null" minlength="3" maxlength="100" spellcheck="false" placeholder="Project Name"></li>
            <li class="spacer"></li>
            <li><button id="btn_action_project_new">New</button></li>
            <li><button onclick="document.getElementById('openfile_json').click()">Load</button></li>
            <li title="Unbake: Upload exported GLB files only"><button onclick="document.getElementById('openfile_baked_glb').click()">Load Bakes</button></li>
            <li><button id="btn_action_project_save">Save</button></li>
            <li class="category">SNAPSHOTS</li>
            <li><button onclick="document.getElementById('openfile_snapshot_zip').click()">Load Archive</button></li>
            <li><button id="btn_action_snapshots_save">Save Archive</button></li>
            <li class="category">MAGICAVOXEL</li>
            <li><button onclick="document.getElementById('openfile_vox').click()">Load VOX</button></li>
            <li><button id="btn_action_save_vox">Save VOX</button></li>
            <li class="category">IMPORT</li>
            <li title="Importing voxel data from JSON without user settings"><button onclick="document.getElementById('openfile_import_voxels').click()">JSON Voxels</button></li>
            <li class="category">EXPORT</li>
            <li class="row_input">
                <label style="width: 60%;">Format</label><select id="input_raw_export_format">
                    <option value="obj_raw" selected>OBJ</option>
                    <option value="stl_raw">STL</option>
                    <option value="ply_raw">PLY</option>
                </select>
            </li>
            <li class="spacer"></li>
            <li><button id="btn_action_raw_export">Raw Voxels</button></li>
            <li class="category">CAPTURE</li>
            <li><button id="btn_action_screenshot">Screenshot</button></li>
        </ul>

        <ul class="menu panel" id="menu-storage">
            <li class="category">SNAPSHOTS</li>
            <li><label id="used_storage"></label></li>
            <li class="spacer"></li>
            <li id="snapshots"></li>
        </ul>

        <ul class="menu panel" id="menu-camera">
            <li class="category">VIEW</li>
            <li><button id="btn-ortho">Perspective</button></li>
            <li class="spacer"></li>
            <li class="row">
                <button id="btn_action_camera_preset_back" class="row_round_s" title="Back View">B</button>
                <button id="btn_action_camera_preset_top" class="row_round_m" title="Top View">T</button>
                <button id="btn_action_camera_preset_front" class="row_round_e" title="Front View">F</button>
            </li>
            <li class="row">
                <button id="btn_action_camera_preset_left" class="row_round_s" title="Left View">L</button>
                <button id="btn_action_camera_preset_bottom" class="row_round_m" title="Bottom View">B</button>
                <button id="btn_action_camera_preset_right" class="row_round_e" title="Right View">R</button>
            </li>
            <li class="category">FRAME</li>
            <li><button id="btn_action_camera_frame">Frame All</button></li>
            <li><button id="btn_tool_frame_color" class="tool tool_frame_color">Frame Color</button></li>
            <li><button id="btn_tool_frame_voxels" class="tool tool_frame_voxels">Frame Voxels</button></li>
            <li><button id="btn_tool_frame_island" class="tool tool_frame_island">Frame Island</button></li>
            <li class="category">SETTINGS</li>
            <li class="row_input" title="Offset varies in different dimensions"><label>Offset</label> <input id="input-camera-offset" type="number" class="ignorekeys" value="1.7" min="0" step="0.01"></li>
            <li class="row_input"><label>FOV</label> <input id="input-camera-fov" type="number" class="ignorekeys" value="0.8" min="0.1" step="0.01"></li>
            <li class="row_input"><label>F-Stop</label> <input type="number" id="input-camera-fstop" class="ignorekeys" value="1.4" min="0" step="0.01"></li>
            <li class="row_input"><label>Focal Len</label> <input type="number" id="input-camera-focal" class="ignorekeys" value="25" min="0" step="0.01"></li>
            <li class="category">ANIMATION</li>
            <li><input id="input-camera-autoframe" type="checkbox"></input> <label for="input-camera-autoframe">Auto Frame</label></li>
            <li><input type="checkbox" id="input-autorotate"> <label for="input-autorotate">Auto Rotate</label></li>
            <li><input type="checkbox" id="input-autorotate-ccw"> <label for="input-autorotate-ccw">CCW</label></li>
            <li><label class="help">? F key is supported during transforms and mesh selection.</label></li>
        </ul>

        <ul class="menu panel" id="menu-render">
            <li class="category">SETTINGS</li>
            <li class="row_input"><label>DPR</label> <input type="number" id="input-pt-dpr" class="ignorekeys" value="0.8" min="0.1" max="1" step="0.05"></li>
            <li class="row_input"><label>Samples</label> <input type="number" id="input-pt-maxsamples" class="ignorekeys" value="512" min="8" step="8"></li>
            <li class="row_input"><label>Bounces</label> <input type="number" id="input-pt-bounces" class="ignorekeys" value="1" min="1" step="1"></li>
            <li class="row_input"><label>Tiles</label> <input type="number" id="input-pt-tiles" class="ignorekeys" value="4" min="1" step="1"></li>
            <li class="spacer"></li>
            <li class="row_input">
                <label>Tonemap</label> <select id="input-pt-tonemap">
                    <option value="0" selected>None</option>
                    <option value="1">Linear</option>
                    <option value="2">Reinhard</option>
                    <option value="3">Cineon</option>
                    <option value="4">ACESFilmic</option>
                    <option value="5">AgX</option>
                    <option value="6">Neutral</option>
                </select>
            </li>
            <li class="category">ENVIRONMENT</li>
            <li>
                <select id="btn_action_hdr_dropdown" style="text-align: left;">
                    <option value="./assets/hdr_overcast_soil_puresky_1k.hdr">Default (local)</option>
                    <option value="./assets/hdr_black.hdr">Black (local)</option>
                    <option value="https://media.githubusercontent.com/media/KhronosGroup/glTF-Sample-Environments/main/footprint_court.hdr">DLC: Footprint Court</option>
                    <option value="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/venice_sunset_1k.hdr">DLC: Venice Sunset</option>
                    <option value="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/pedestrian_overpass_1k.hdr">DLC: Pedestrian Overpass</option>
                    <option value="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/blouberg_sunrise_2_1k.hdr">DLC: Blouberg Sunrise</option>
                    <option value="https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/textures/equirectangular/quarry_01_1k.hdr">DLC: Quarry</option>
                </select>
            </li>
            <li class="row">
                <button id="btn_action_hdr_unload" class="row_round_s">Unload</button>
                <button class="row_round_e" onclick="document.getElementById('openfile_hdr').click()">Load</button>
            </li>
            <li class="spacer"></li>
            <li><input type="checkbox" id="input-pt-hdri-background"> <label for="input-pt-hdri-background">Background</label></li>
            <li class="spacer"></li>
            <li class="row_input"><label>Power</label> <input type="number" id="input-pt-envpower" class="ignorekeys" value="0.65" min="0.01" step="0.01"></li>
            <li class="row_input"><label>Blur</label> <input type="number" id="input-pt-hdri-blur" class="ignorekeys" value="0.05" min="0" step="0.01"></li>
            <li class="category">DIRECT LIGHT</li>
            <li class="row_color"><label>Light</label> <input type="color" id="input-pt-light-color" value="#FFE484"></li>
            <li class="row_input"><label>Intensity</label> <input type="number" id="input-pt-light-intensity" class="ignorekeys" value="0.8" min="0" step="0.01"></li>
            <li class="category">MATERIALS</li>
            <li class="row_input"><label for="input-pt-roughness">Roughness</label> <input id="input-pt-roughness" class="ignorekeys" type="number" value="0.8" min="0" step="0.01"></input></li>
            <li class="row_input"><label for="input-pt-metalness" style="margin-right: 4px">Metalness</label> <input id="input-pt-metalness" class="ignorekeys" type="number" value="0" min="0" step="0.01"></input></li>
            <li class="row_input"><label for="input-pt-transmission" style="margin-right: 9px">Xmission</label> <input id="input-pt-transmission" class="ignorekeys" type="number" value="0" min="0" step="0.01"></input></li>
            <li class="row_input" title="Black voxels are emissive"><label style="margin-right: 7px">Emissive</label> <input type="color" id="input-pt-emissive" value="#5EC3C5"></li>
            <li class="row_input" title="Emissive Intensity"><label for="input-pt-emissive-intensity" style="margin-right: 8px">Intensity</label> <input id="input-pt-emissive-intensity" class="ignorekeys" type="number" value="2" min="0" step="0.01"></input></li>
            <li class="category">MORE</li>
            <li><input id="input-pt-autostart" type="checkbox"></input> <label for="input-pt-autostart">Auto Start</label></li>
            <li><input id="input-pt-shade" type="checkbox"></input> <label for="input-pt-shade">Shade Mode</label></li>
            <li class="row_input"><label for="input-pt-plane">Plane</label> <input id="input-pt-plane" class="ignorekeys" type="number" value="0" min="0" step="1"></input></li>
            <li class="row_input"><label>Color</label> <input type="color" id="input-pt-plane-color" value="#90A0B3"></li>
        </ul>

        <ul class="menu panel" id="menu-voxelize">
            <li class="category">MODELS</li>
            <li class="row"><label style="margin-right: 10px">Scale</label><input type="number" class="ignorekeys" id="input-voxelizer-scale" value="50" min="1"></li>
            <li class="spacer"></li>
            <li><button onclick="document.getElementById('openfile_voxelizer').click()">Upload Model</button></li>
            <li><label class="help">? GLB | OBJ | STL | PLY</label></li>
            <li class="category">IMAGES</li>
            <li class="row"><label style="margin-right: 10px">Ratio</label> <input type="number" class="ignorekeys" id="input-voxelizer-ratio" value="5.0" min="0.1" step="0.1"></li>
            <li class="spacer"></li>
            <li><input type="checkbox" id="input-voxelizer-vertical" checked> <label for="input-voxelizer-vertical">Vertical</label></li>
            <li class="spacer"></li>
            <li><button onclick="document.getElementById('openfile_voxelizer_img').click()">Upload Image</button></li>
            <li class="category">TEXTS</li>
            <li><input type="text" id="input-voxelizer-font" class="ignorekeys" value="48px Roboto" placeholder="Size Font" spellcheck="false"></li>
            <li><input type="text" id="input-voxelizer-text" class="ignorekeys" placeholder="Type here" spellcheck="false"></li>
            <li class="row"><label style="margin-right: 10px">Extrude</label> <input type="number" class="ignorekeys" id="input-voxelizer-text-extrude" value="5" min="1" step="1"></li>
            <li class="spacer"></li>
            <li><input type="checkbox" id="input-voxelizer-text-vertical" checked> <label for="input-voxelizer-text-vertical">Vertical</label></li>
            <li><input type="checkbox" id="input-voxelizer-text-emoji"> <label for="input-voxelizer-text-emoji">Colored Emoji</label></li>
            <li class="spacer"></li>
            <li><button id="btn_action_voxelize_text">Generate Text</button></li>
            <li><label class="help">? Use "XFORM Island" to transform characters.<br>? Use "Bucket Island" to paint characters.</label></li>
        </ul>

        <ul class="menu panel" id="menu-create">
            <li class="category">BOX</li>
            <li>
                <div class="row">&nbsp;<label style="margin-right: 4px">X</label>&nbsp;<input id="create_grid_x" type="number" class="ignorekeys" value="20" min="1"></div>
                <div class="row">&nbsp;<label style="margin-right: 4px">Y</label>&nbsp;<input id="create_grid_y" type="number" class="ignorekeys" value="20" min="1"></div>
                <div class="row">&nbsp;<label class="Z">Z</label>&nbsp;<input id="create_grid_z" type="number" class="ignorekeys" value="20" min="1"></div>
                <div class="spacer"></div>
                <input type="checkbox" id="create_grid_fill" checked> <label for="create_grid_fill">Fill Box</label><br>
                <div class="spacer"></div>
                <div class="row">
                    <button id="btn_action_create_box">Box</button>
                    <button id="btn_action_create_plane">Plane</button>
                </div>
                <button id="btn_action_create_isometric">Isometric</button>
            </li>
            <li class="category">SPHERE</li>
            <li>
                <div class="row">&nbsp;<label style="margin-right: 6px">Outer</label>&nbsp;<input id="create_sphere_outer" type="number" class="ignorekeys" value="20" min="3"></div>
                <div class="row">&nbsp;<label style="margin-right: 8px">Inner</label>&nbsp;<input id="create_sphere_inner" type="number" class="ignorekeys" value="10" min="0"></div>
                <div class="spacer"></div>
                <div title="Adds inner voxels and paints them using the selected color"><input type="checkbox" id="create_sphere_inner_color" checked> <label for="create_sphere_inner_color">Colored Inner</label></div>
                <div class="spacer"></div>
                <button id="btn_action_create_sphere">Sphere</button>
            </li>
            <li class="category">TERRAIN</li>
            <li>
                <div class="row">&nbsp;<label style="margin-right: 4px">X</label>&nbsp;<input id="create_terrain_x" type="number" class="ignorekeys" value="100" min="3"></div>
                <div class="row">&nbsp;<label style="margin-right: 4px">Y</label>&nbsp;<input id="create_terrain_y" type="number" class="ignorekeys" value="5" min="1"></div>
                <div class="row">&nbsp;<label class="Z">Z</label>&nbsp;<input id="create_terrain_z" type="number" class="ignorekeys" value="100" min="3"></div>
                <div class="spacer"></div>
                <input type="checkbox" id="create_terrain_grad" checked> <label for="create_terrain_grad">Height Gradient</label><br>
                <div class="spacer"></div>
                <button id="btn_action_create_terrain">Terrain</button>
            </li>
        </ul>

        <ul class="menu panel" id="menu-symm">
            <li class="category">SYMMETRY AXIS</li>
            <li class="row">
                <button id="btn-symm-axis-s" class="row_round_s">S</button>
                <button id="btn-symm-axis-x" class="row_round_m">X</button>
                <button id="btn-symm-axis-y" class="row_round_m">Y</button>
                <button id="btn-symm-axis-z" class="row_round_e">Z</button>
            </li>
            <li class="category">SYMMETRIZE</li>
            <li id="btn_action_symm_p2n"><button>Pos (+) > Neg (-)</button></li>
            <li id="btn_action_symm_n2p"><button>Neg (-) > Pos (+)</button></li>
            <li class="category">MIRROR</li>
            <li id="btn_action_symm_mirror"><button>Mirror</button></li>
            <li class="category">DELETE HALF</li>
            <li id="btn_action_symm_half_p"><button>Positive Half</button></li>
            <li id="btn_action_symm_half_n"><button>Negative Half</button></li>
            <li class="category">OPTIONS</li>
            <li><input type="checkbox" id="input-symm-preview" checked> <label for="input-symm-preview">Preview Box</label></li>
            <li><input type="checkbox" id="input-symm-worldcenter"> <label for="input-symm-worldcenter">World Center</label></li>
        </ul>

        <ul class="menu panel" id="menu-draw">
            <li class="category">FREEFORM</li>
            <li><button id="btn_tool_add" class="tool tool_add">Add</button></li>
            <li><button id="btn_tool_remove" class="tool tool_remove">Remove</button></li>
            <li><button id="btn_tool_bridge" class="tool tool_bridge">Bridge</button></li>
            <li class="spacer"></li>
            <li><input type="checkbox" id="input-tool-bridge-bypass"> <label for="input-tool-bridge-bypass">Bypass Bridge</label></li>
            <li class="category">BOX SHAPE</li>
            <li><button id="btn_tool_box_add" class="tool tool_box_add">Box Add</button></li>
            <li><button id="btn_tool_box_remove" class="tool tool_box_remove">Box Remove</button></li>
            <li class="spacer"></li>
            <li class="row_input"><label>Add Wall</label> <input id="input-tool-boxheight" type="number" class="ignorekeys" value="1" min="1" step="1"></li>
            <li class="category">RECTANGLE</li>
            <li><button id="btn_tool_rect_add" class="tool tool_rect_add">Rect Add</button></li>
            <li><button id="btn_tool_rect_remove" class="tool tool_rect_remove">Rect Remove</button></li>
            <li class="spacer"></li>
            <li><input type="checkbox" id="input-tool-rectadd-bypass"> <label for="input-tool-rectadd-bypass">Bypass Add</label></li>
            <li><label class="help">? Best in Orthographic</label></li>
            <li class="category">COORDINATE</li>
            <li><input id="input-newbox-coord" type="text" class="ignorekeys" placeholder="X, Y, Z"></li>
        </ul>

        <ul class="menu panel" id="menu-paint">
            <li class="category">PAINT COLOR</li>
            <li><button id="btn_tool_paint" class="tool tool_paint">Freeform</button></li>
            <li><button id="btn_tool_box_paint" class="tool tool_box_paint">Box Paint</button></li>
            <li><button id="btn_tool_rect_paint" class="tool tool_rect_paint">Rect Paint</button></li>
            <li class="category">FILL COLOR</li>
            <li><button id="btn_tool_bucket_group" class="tool tool_bucket_group">Bucket Group</button></li>
            <li><button id="btn_tool_bucket_island" class="tool tool_bucket_island">Bucket Island</button></li>
            <li class="spacer"></li>
            <li title="Island: Treats the corners as a connected island"><input type="checkbox" id="input-tool-bucket-island-connected" checked> <label for="input-tool-bucket-island-connected">Add Connected</label></li>
            <li class="spacer"></li>
            <li><button id="btn_action_paint_all">Paint All</button></li>
            <li class="category">PICK COLOR</li>
            <li><button id="btn_tool_eyedropper" class="tool tool_eyedropper">Eyedropper</button></li>
        </ul>

        <ul class="menu panel" id="menu-xform">
            <li class="category">TRANSFORM</li>
            <li><button id="btn_tool_transform_box" class="tool tool_transform_box">Box Shape</button></li>
            <li><button id="btn_tool_transform_rect" class="tool tool_transform_rect">Rectangle</button></li>
            <li><button id="btn_tool_transform_group" class="tool tool_transform_group">Color Group</button></li>
            <li><button id="btn_tool_transform_island" class="tool tool_transform_island">Island Voxels</button></li>
            <li><button id="btn_tool_transform_visible" class="tool tool_transform_visible">Visible Voxels</button></li>
            <li class="spacer"></li>
            <li title="Check this to apply transforms on mesh picks"><input type="checkbox" id="input-transform-reactive" checked> <label for="input-transform-reactive">Auto Reactive</label></li>
            <li><input type="checkbox" id="input-transform-clone"> <label for="input-transform-clone">Clone Voxels</label></li>
            <li title="Island: Treats the corners as a connected island"><input type="checkbox" id="input-transform-island-connected" checked> <label for="input-transform-island-connected">Add Connected</label></li>
            <li><label class="help">? Apply: Enter<br>? Clone: Shift<br>? Delete: Del<br>? Camera: F<br>? Paintable<br>? No Symmetry</label></li>
            <li class="category">MANIPULATE</li>
            <li title="Translate corner to world-center"><button id="btn_action_normalize">Normalize</button></li>
            <li title="Translate center to world-center"><button id="btn_action_centralize">Centralize</button></li>
            <li class="spacer"></li>
            <li title="Removes internal voxels that are not visible from the outside"><button id="btn_action_optimize">Optimize</button></li>
            <li title="Increases the quality of the model by a factor of 2"><button id="btn_action_upsample">Upsample</button></li>
            <li class="spacer"></li>
            <li><button id="btn_tool_measure_volume" class="tool tool_measure_volume">Measure Volume</button></li>
        </ul>

        <ul class="menu panel" id="menu-groups">
            <li class="category">COLOR GROUPS</li>
            <li><button id="btn_action_groupislands">Group by Islands</button></li>
            <li class="spacer"></li>
            <li title="Treats the corners as a connected island"><input type="checkbox" id="input-groupislands-connected" checked> <label for="input-groupislands-connected">Add Connected</label></li>
            <li class="category">VISIBILITY</li>
            <li><button id="btn_tool_isolate_color" class="tool tool_isolate_color">Isolate Color</button></li>
            <li><button id="btn_tool_hide_color" class="tool tool_hide_color">Hide Color</button></li>
            <li><button id="btn_action_invertvisibility">Invert Visibility</button></li>
            <li><button id="btn_action_unhideall">Unhide All</button></li>
            <li class="category">SLICE VIEW</li>
            <li class="row_input" title="View specific level of voxels in Y direction"><label>Slice Y</label> <input id="input-group-slice-y" type="number" class="ignorekeys" value="0" step="1"></li>
            <li class="spacer"></li>
            <li><button id="btn_action_getmultiplane">Get MultiPlane</button></li>
            <li><button id="btn_action_setmultiplane">Set MultiPlane</button></li>
            <li class="category">DELETE</li>
            <li><button id="btn_tool_delete_color" class="tool tool_delete_color">Delete by Color</button></li>
            <li><button id="btn_action_deletehidden">Delete Hidden</button></li>
            <li><label class="help">? Each color is a group, Set a unique color to define color groups.</label></li>
        </ul>

        <ul class="menu panel" id="menu-bakery">
            <li class="category">BAKERY</li>
            <li><button id="btn_action_bakery_bake_colors">Bake by Colors</button></li>
            <li><button id="btn_action_bakery_bake_islands">Bake by Islands</button></li>
            <li class="spacer"></li>
            <li title="Treats the corners as a connected island"><input type="checkbox" id="input-bake-islands-connected" checked> <label for="input-bake-islands-connected">Add Connected</label></li>
            <li class="spacer"></li>
            <li><button id="btn_tool_bake_color" class="tool tool_bake_color">Bake Color</button></li>
            <li class="category">DELETE<li>
            <li><button id="btn_action_bakery_delete">Delete Selected</button></li>
            <li><button id="btn_action_bakery_delete_all">Delete All Bakes</button></li>
            <li><label class="help">? The baked mesh is without mesh volume and shared faces, ready for Blender or 3D printing.</label></li>
        </ul>

        <ul class="menu panel" id="menu-pbr">
            <li class="category">COLORS</li>
            <li class="row_color"><label>Vertex</label> <input type="color" id="input-pbr-vertexcolor" value="#CCCCCC"></li>
            <li class="row_color"><label>Albedo</label> <input type="color" id="input-pbr-albedo" value="#CCCCCC"></li>
            <li class="row_color"><label>Emissive</label> <input type="color" id="input-pbr-emissive" value="#111111"></li>
            <li class="category">PROPERTIES</li>
            <li class="row"><label style="margin-right: 5px">Roughness</label> <input id="input-pbr-roughness" type="number" class="ignorekeys" value="1" min="0" step="0.01"></li>
            <li class="row"><label style="margin-right: 22px">Metallic</label> <input id="input-pbr-metallic" type="number" class="ignorekeys" value="0" min="0" step="0.01"></li>
            <li class="row"><label style="margin-right: 36px">Alpha</label> <input id="input-pbr-alpha" type="number" class="ignorekeys" value="1" min="0.1" step="0.01"></li>
            <li class="category">DISPLAY<li>
            <li><input type="checkbox" id="input-pbr-wireframe"> <label for="input-pbr-wireframe">Wireframe</label></li>
            <li><label class="help">? Select a mesh first</label></li>
        </ul>

        <ul class="menu panel" id="menu-export">
            <li class="category">EXPORT BAKES</li>
            <li class="row_input">
                <label style="width: 60%;">Format</label><select id="input_export_format">
                    <option value="glb">GLB</option>
                    <option value="gltf">GLTF</option>
                    <option value="obj">OBJ</option>
                    <option value="stl">STL</option>
                    <option value="ply">PLY</option>
                </select>
            </li>
            <li class="spacer"></li>
            <li><input type="checkbox" id="export_selected_bake"> <label for="export_selected_bake">Selected Mesh</label></li>
            <li><input type="checkbox" id="export_texture" checked disabled> <label for="export_texture">Export Texture</label></li>
            <li class="spacer"></li>
            <li><button id="btn_action_export_meshes">Export Meshes</button></li>
            <li><label class="help">? Keeping the exported GLB file means you have the voxel data. see File menu, "Load Bakes"</label></li>
        </ul>

    </div>
    <!-- end menus -->

    <!-- in-screen toolbars -->
    <ul id="toolbar-screen-top-mode">
        <li id="tab-model" class="mode mode_select">MODEL</li>
        <li id="tab-render" class="mode">RENDER</li>
        <li id="tab-export" class="mode">EXPORT</li>
    </ul>

    <ul id="toolbar-screen-top-mem">
        <li title="Undo"><i class="material-icons">arrow_back_ios</i></li>
        <li title="Redo"><i class="material-icons">arrow_forward_ios</i></li>
    </ul>

    <ul id="toolbar-screen-storage">
        <li title="Quick Load (Preserves Camera)"><button>LOAD</button></li>
        <li title="Quick Save"><button>SAVE</button></li>
    </ul>

    <ul id="toolbar-screen-material">
        <li><input type="color" id="input-color" value="#4674A4"></li>
        <li><button id="btn_tool_bucket_group_screen" class="tool tool_bucket_group" title="Bucket Group Tool"><i class="material-icons">format_color_fill</i></button></li>
        <li><button id="btn_tool_eyedrop_screen" class="tool tool_eyedropper" title="Eyedropper Tool"><i class="material-icons">colorize</i></button></li>
        <li><button id="material-switch" title="Material Switch">CEL</button></li>
    </ul>

    <ul id="toolbar-screen-render">
        <li><button><i class="material-icons">play_arrow</i></button></li>
        <li><button><i class="material-icons">pause</i></button></li>
        <li><button>SHOT</button></li>
    </ul>

    <ul id="toolbar-screen-export">
        <li><button>BAKE</button></li>
        <li><button>GLB</button></li>
    </ul>

    <ul id="toolbar-screen-toggles">
        <li><button id="btn-screen-floorplane" title="Floor Plane"><i class="material-icons">grid_4x4</i></button></li>
        <li><button id="btn-screen-volumeplane" title="Volume Plane"><i class="material-icons">grid_on</i></button></li>
        <li><button id="btn-screen-multiplane" title="Multi Plane"><i class="material-icons">grid_goldenratio</i></button></li>
        <li><button id="btn-screen-lightlocator" title="Light Locator"><i class="material-icons">tungsten</i></button></li>
        <li><button id="btn-screen-symmetry" title="Symmetry">S</button></li>
        <li><button id="btn-screen-ortho" title="Orthographic View">P</button></li>
    </ul>

    <!-- hover -->
    <div id="hover">
        <button class="tool_camera"><i class="material-icons">control_camera</i></button>
        <ul>
            <li class="tool_box_add hover_item_hide"><i class="material-icons">add</i></li>
            <li class="tool_box_remove hover_item_hide"><i class="material-icons">remove</i></li>
            <li class="tool_transform_box hover_item_hide"><i class="material-icons">select_all</i></li>
            <li class="tool_box_paint hover_item_hide"><i class="material-icons">brush</i></li>
        </ul>
    </div>

    <!-- options screen -->
    <ul id="options_screen">
        <li title="Create new scene on import, load, snapshot, generate and voxelize"><input type="checkbox" id="check_screen_newscene" checked> <label for="check_screen_newscene">NEW SCENE</label></li>
        <li title="Snap drawing to workplanes"><input type="checkbox" id="check_workplane_only"> <label for="check_workplane_only">WORKPLANES</label></li>
    </ul>

    <!-- color pickers -->
    <div id="color-wheel"></div>
    <ul id="color-picker">
        <li id="color-picker-wheel"></li>
        <li id="color-picker-selected"><div title="Previous"></div><div title="Current"></div></li>
        <li class="row_input"><label>HEX</label> <input type="text" id="color-picker-hex" class="ignorekeys" value="#FFFFFF" spellcheck="false"></li>
        <li class="row_input"><label>RGB</label> <input type="text" id="color-picker-rgb" class="ignorekeys" value="255, 255, 255" spellcheck="false"></li>
    </ul>

    <!-- dynamic -->
    <div id="marquee"></div>
    <div id="palette"><canvas id="canvas_palette"></canvas></div>
    <div id="meshlist"></div>
    <div id="info"><span>0</span> &nbsp; <span>0</span> &nbsp; <span>0</span> &nbsp; <span>0</span></div>
    <div id="info_render"><span>0</span> &nbsp; SL <span>0</span> / <span>0</span> &nbsp; <span>0</span> &nbsp; BOUNCE <span>0</span></div>
    <div id="info_tool" title="Active Tool"></div>
    <div id="progressbar"></div>
    <div id="confirm"><button></button></div>
    <div id="confirmblocker"></div>
    <div id="notifier"></div>
    <div id="introscreen">
        <div class="anim"><div class="cube"><div class="cube-faces"><div class="cube-face shadow"></div><div class="cube-face bottom"></div><div class="cube-face top"></div><div class="cube-face left"></div><div class="cube-face right"></div><div class="cube-face back"></div><div class="cube-face front"></div></div></div></div>
        <div class="logo">V<span class="logo_white">OXEL BUILDER</span></div><div class="progress">- INITIALIZING -</div>
    </div>

    <!-- hidden -->
    <input style="display: none" type="file" id="openfile_json" accept=".json,.vbx" onclick="this.value = null">
    <input style="display: none" type="file" id="openfile_import_voxels" accept=".json" onclick="this.value = null">
    <input style="display: none" type="file" id="openfile_vox" accept=".vox" onclick="this.value = null">
    <input style="display: none" type="file" id="openfile_voxelizer" accept=".obj,.glb,.stl,.ply" onclick="this.value = null">
    <input style="display: none" type="file" id="openfile_voxelizer_img" accept=".jpg,.png,.svg" onclick="this.value = null">
    <input style="display: none" type="file" id="openfile_hdr" accept=".hdr" onclick="this.value = null">
    <input style="display: none" type="file" id="openfile_baked_glb" accept=".glb" onclick="this.value = null">
    <input style="display: none" type="file" id="openfile_snapshot_zip" accept=".zip" onclick="this.value = null">

    <!-- shortcuts -->
    <div id="shortcuts" onclick="this.style.display = 'none'" title="Click to Close">
        <span>â ï¸ It is recommended to hold down the SPACE or ALT key to toggle the Free Camera while modeling or with a tool active, on the desktop. (just like in Blender, Maya, etc.)</span>
        <hr>
        <table>
            <tr><td>SPACE, ALT</td> <td>Toggle Free Camera (MODEL)</td></tr>
            <tr><td>ENTER</td> <td>Apply Transforms (MODEL)</td></tr>
            <tr><td>CTRL</td> <td>Translate Camera (MODEL)</td></tr>
            <tr><td>SHIFT</td> <td>Clone Transform (XFORM)</td></tr>
            <tr><td>DEL</td> <td>Delete Selected Voxels (XFORM)</td></tr>
            <tr><td>DEL</td> <td>Delete Selected Meshes (EXPORT)</td></tr>
            <tr><td>[ ` ], C</td> <td>Free Camera Tool (MODEL)</td></tr>
            <tr><td>F</td> <td>Frame Camera (ALL MODES)</td></tr>
            <tr><td>F</td> <td>Frame Selected Voxels (XFORM)</td></tr>
            <tr><td>F</td> <td>Frame Selected Meshes (RENDER/EXPORT)</td></tr>
            <tr><td>O</td> <td>Toggle Orthographic camera</td></tr>
            <tr><td>R</td> <td>Toggle Render tab</td></tr>
            <tr><td>S</td> <td>Switch Symmetry Axis</td></tr>
            <tr><td>T</td> <td>Tool: Transform Box</td></tr>
            <tr><td>1</td> <td>Tool: Add Voxel</td></tr>
            <tr><td>2</td> <td>Tool: Remove Voxel</td></tr>
            <tr><td>3</td> <td>Tool: Box Add</td></tr>
            <tr><td>4</td> <td>Tool: Box Remove</td></tr>
            <tr><td>5</td> <td>Tool: Paint Voxel</td></tr>
            <tr><td>6</td> <td>Tool: Box Paint</td></tr>
            <tr><td>7</td> <td>Tool: Paint Bucket Group</td></tr>
            <tr><td>8</td> <td>Tool: Color Eyedropper</td></tr>
            <tr><td>CTRL + Z</td> <td>Undo (MODEL)</td></tr>
            <tr><td>CTRL + X</td> <td>Redo (MODEL)</td></tr>
            <tr><td>CTRL + /</td> <td>Toggle Inspector</td></tr>
        </table>
    </div>

<script src="libs/babylon.js"></script>
<script src="libs/babylonjs.materials.min.js"></script>
<script type="importmap">
{
    "imports": {
        "three": "./libs/three.module.min.js"
    }
}
</script>
<script src="main.js" type="module"></script>
<script src="libs/utils/jszip.min.js"></script>

<script type="x-shader/x-vertex" id="uniVertexShader">
    precision highp float;

    attribute vec3 position;
    attribute vec3 normal;
    attribute vec2 uv;
    attribute vec4 color;

    varying vec3 vPosition;
    varying vec3 vPositionW;
    varying vec3 vNormalW;
    varying vec2 vUv;
    varying vec4 vColor;

    uniform mat4 viewProjection;

    #include<instancesDeclaration>

    void main() {
        #include<instancesVertex>
        
        vec4 worldPos = finalWorld * vec4(position, 1.0);
        gl_Position = viewProjection * worldPos;
        
        #include<vertexColorMixing>
        
        vPosition = normalize(gl_Position.xyz);
        vPositionW = vec3(worldPos);
        vNormalW = normalize(vec3(finalWorld * vec4(normal, 0.0)));
        vUv = uv;
    }
</script>
<script type="x-shader/x-fragment" id="celFragmentShader">
    precision highp float;

    varying vec3 vPosition;
    varying vec3 vPositionW;
    varying vec3 vNormalW;
    varying vec2 vUv;
    varying vec4 vColor;

    uniform vec3 uLightPos;
    uniform vec3 uLightCol;
    uniform int uTextureId;
    uniform sampler2D uTexture;

    void main() {
        vec3 N = normalize(vNormalW);
        vec3 L = normalize(uLightPos - vPositionW);

        vec2 grid = abs(fract(vUv - 0.5) - 0.5) / fwidth(vUv);
        float line = min(grid.x, grid.y);
        line = 1.0 - min(line, 1.0);

        float amb = clamp(1.0 + 0.25 * N.y, 0.0, 1.0);
        if (dot(N, L) < 0.0)
            amb *= 1.5;

        float dif = 1.0 * max(0.5, dot(N, L));
        dif -= 0.5 * max(0.0, dot(N, -L));

        float ao = pow(max(0.0, dot(N, L)) + 0.05, 4.0);
        float curvature = abs(dot(N, vPosition));
        ao = mix(0.5, 1.0, ao);
        ao = mix(ao, 0.3, curvature * 0.5);

        vec3 brdf = vec3(0);
        brdf += 1.0 * amb * ao;
        brdf += 1.0 * dif * uLightCol;

        vec3 col = vColor.rgb;
        col *= brdf;

        if (uTextureId == 1) 
            col = mix(col, vec3(0), line * 0.22);

        col = pow(col, vec3(0.4545));

        if (uTextureId > 1)
            col *= texture2D(uTexture, vUv).rgb;

        gl_FragColor = vec4(col, 1.0);
    }
</script>
<script type="x-shader/x-fragment" id="fxOutlineFragmentShader">
    #ifdef GL_ES
        precision highp float;
    #endif

    varying vec2 vUV;

    uniform vec2 uRes;
    uniform sampler2D textureSampler;
    
    // image based edge detection
    vec3 sobel(sampler2D tex, vec2 uv) {
        vec3 Gx = vec3(0);
        vec3 Gy = vec3(0);
        vec3 e = vec3(0.0, 1.0, -1.0);
        vec2 tx = 1.0 / uRes.xy;
        
        Gx += texture(tex, uv + tx * e.zz).rgb * 1.0;
        Gx += texture(tex, uv + tx * e.zx).rgb * 2.0;
        Gx += texture(tex, uv + tx * e.zy).rgb * 1.0;

        Gx += texture(tex, uv + tx * e.yy).rgb * -1.0;
        Gx += texture(tex, uv + tx * e.yx).rgb * -2.0;
        Gx += texture(tex, uv + tx * e.yz).rgb * -1.0;
        
        Gy += texture(tex, uv + tx * e.zy).rgb * 1.0;
        Gy += texture(tex, uv + tx * e.xy).rgb * 2.0;
        Gy += texture(tex, uv + tx * e.yy).rgb * 1.0;

        Gy += texture(tex, uv + tx * e.zz).rgb * -1.0;
        Gy += texture(tex, uv + tx * e.xz).rgb * -2.0;
        Gy += texture(tex, uv + tx * e.yz).rgb * -1.0;
        
        return sqrt(Gx*Gx + Gy*Gy);
    }

    void main() {
        vec2 uv = gl_FragCoord.xy / uRes.xy;

        vec3 sb = sobel(textureSampler, uv);
        float mx = max(max(sb.r, sb.g), sb.b);
        float aa = smoothstep(1.0, 0.0, mx);
    	float edge = step(mx, 0.5);

        vec3 col = texture2D(textureSampler, vUV).rgb;
        col = mix(col, col * edge * aa, 1.0);

        gl_FragColor = vec4(col, 1.0);
    }
</script>
<script type="x-shader/x-fragment" id="fxCustomFragmentShader">
    #ifdef GL_ES
        precision highp float;
    #endif

    varying vec2 vUV;

    uniform vec2 uRes;
    uniform float uTime;
    uniform sampler2D textureSampler;

    void main() {
        vec2 uv = gl_FragCoord.xy / uRes.xy;

        vec3 col = texture2D(textureSampler, vUV).rgb;

        // Add user content and experiments here

        gl_FragColor = vec4(1.0 - col, 1.0);
    }
</script>
</body>
</html>
